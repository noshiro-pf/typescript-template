# Repository Guidelines

## Project Structure & Module Organization

- Source: `src/` (ESM TypeScript, `.mts`). Entry points and utilities live here; `index.mts` re-exports modules.
- Tests: `test/` (Vitest, `.mts`). Coverage output in `coverage/`.
- Build output: `dist/` (ES modules `.mjs`, type defs `.d.mts`).
- Config: `configs/` (TS, Vitest, Rollup, Typedoc), root linters and tooling configs.
- Scripts: `scripts/` (Node `tsx`-run helpers, e.g., build, checks, GitHub rules).
- Docs: `docs/` generated by Typedoc.

## Build, Test, and Development Commands

- `pnpm run build` — Rollup build into `dist/`.
- `pnpm run type-check` — TypeScript type checking (no emit).
- `pnpm run test` — Run Vitest once. `testw` for watch, `test:ui` for UI, `test:cov` for coverage, `test:cov:ui` to preview coverage.
- `pnpm run lint` / `lint:fix` — ESLint check/fix.
- `pnpm run fmt` — Format only changed files against `origin/main`. Use `fmt:full` for the entire repo.
- `pnpm run check-all` — Aggregate checks (types, lint, tests, markdown, spellcheck).
- `pnpm run doc` — Generate Markdown docs into `docs/`.

## Coding Style & Naming Conventions

- Indentation: 2 spaces; LF endings. Markdown uses 4-space indents (see `.editorconfig`).
- Language: TypeScript ESM; prefer `.mts` for modules and `.d.mts` for types.
- Imports: use relative paths within `src/`; avoid importing from generated `dist/` and `index.mjs` directly.
- Linting: ESLint with TypeScript, Unicorn, Promise, Security, Functional plugins. Prettier handles formatting.
- Naming: `camelCase` for variables/functions, `PascalCase` for types/classes, `kebab-case` for file names.

## Testing Guidelines

- Framework: Vitest with globals enabled.
- Locations: place unit tests near sources or under `test/` using `*.test.mts`.
- Coverage: keep meaningful coverage; exclude simple re-export files.
- Run locally: `pnpm run test` or `pnpm run testw` during development.

## Commit & Pull Request Guidelines

- Use Conventional Commits to enable semantic-release, e.g.:
    - `feat: add parser for .mts`
    - `fix: handle Windows path resolution`
    - `chore(deps): bump rollup to 4.50.1`
- PRs: include a clear description, link related issues, screenshots or logs when useful, and note breaking changes using “BREAKING CHANGE: …”. Ensure CI passes and `pnpm run check-all` is clean.

## Security & Configuration Tips

- Node ≥ `20.11`. Do not commit secrets; use `.env` (see `.env.example`).
- GitHub rules helpers: `pnpm run apply-branch-protection-rules` and `backup-branch-protection-rules` require a GitHub token in `.env`.
